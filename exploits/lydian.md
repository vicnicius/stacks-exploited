# The Lydian DAO exploit

This was taken from the original Lydian Post Mortem on x.com. Original post: [link](https://twitter.com/Lydian_DAO/status/1690663514774396928)

---

## Thread

ðŸ‘‰ POST MORTEM OF THE LYDIAN THEFT ON AUGUST 10

When Lydian launched, we set out to build a decentralised treasury management protocol with governance that allows for full flexibility, including managing the treasury and directing the funds through governance votes.

This had been going really well and the team was very happy with the way Lydian was farming. Month over month, we saw the treasury value go up in STX, ALEX and DIKO.

About 6 months ago, attacker(s) with address SP1PFZVGWDDAK6TT0BYSFNNCRCYABM0T8TAVME42N started buying up LDN from the LDN/USDA pair in a few transactions:
https://explorer.hiro.so/txid/0x5c5e61bea964ac1c4bd1b58b7208526dc809112f7e80f181900f9b130896fa01?chain=mainnet https://explorer.hiro.so/txid/0x90d95b9c55b882eab40e3120d11259af20f49a0c08fb53537041cec143f0214a?chain=mainnet https://explorer.hiro.so/txid/0xd6ee1eb9be1ffd1b6c12104947d2ce46962622839795efef36ad209ec499772c?chain=mainnet

Note that 1% of the supply is required to start a governance vote, so these swaps were sufficient to start a vote. The attacker then deployed a new governance contract (https://explorer.hiro.so/txid/0x9a120396fdc2b6ca6c4dc08a3efe2b4d01436523ac8ba520fcd70030743d304e?chain=mainnet)

and used that with an old, but still active governance contract ('SP3MBWGMCVC9KZ5DTAYFMG1D0AEJCR7NENTM3FTK5.governance-v1-3) to make themselves owner (https://explorer.hiro.so/txid/0xa0b7b83b8aa8604e067e6f8730f976222bea200f3e47b4851d8aa6a5bbce945a?chain=mainnet).

The reason they deployed a new governance contract as a wrapper is because that way it wouldn't be visible in the contract calls of the governance-v1-3 contract in the Stacks explorer.

In the UI it was not visible either because the current active governance contract is 'SP3MBWGMCVC9KZ5DTAYFMG1D0AEJCR7NENTM3FTK5.governance-v1-4, and all v1-4 proposals would actually show up in the UI. Since then, the Lydian team has disabled v1-1 to v1-3 and only v1-4 is active

Making someone owner means they get execution permissions on the DAO execution contract .lydian-dao-executor-v1-1. Having execution rights on that contract allows the executor to execute contracts straight without going through governance and it wouldn't show up in the UI.

The attacker then made two proposals to swap out the STX/USDA and STX/xBTC LP tokens out of the Lydian wallet

STX/xBTC: https://explorer.hiro.so/txid/0x8fb917b14c32397bdfb0fb0b8094ce1358ff51eeb9ab30c54d5bac94f433df42?chain=mainnet
STX/USDA: https://explorer.hiro.so/txid/0x34c2f9413da3fc07bad80a536f6ef6791618f49ac155537d941b51e93bb935ef?chain=mainnet

The proposals were created 4 months ago, but only executed at the time of the actual attack a few days ago. The attacker had to wait for the actual execution of the attack for the ALEX STX/xBTC cycles to end (since the LP tokens are locked in the ALEX Farmer for up to 32 cycles).

Once the STX/xBTC LP tokens unlocked, both proposals were executed and the attacker(s) got hold of these tokens. The tokens have since been returned and the attacker(s) took their white hat bounty.

In order to mitigate these types of attacks in the future, several actions could be taken:

1. Monitoring of new smart contracts related to critical functions and automatic notifications through Chainhooks (https://github.com/hirosystems/chainhook#development-workflow-for-stacks-chainhooks)

2. Require a minimum amount of votes before a proposal can be successful. As an example, we could keep the 1% of the supply to start a vote, but require a 25-30% of all tokens to participate in a vote. This would make it a lot harder to take over the protocol through governance.

We are looking at both options to make Lydian a safer place to farm yield.

All the funds have been restored again (minus the bounty of around 10% and some fees from swapping). They're all sitting on the treasury wallet, https://explorer.hiro.so/address/SP3MBWGMCVC9KZ5DTAYFMG1D0AEJCR7NENTM3FTK5?chain=mainnet

Next steps for the Lydian DAO and community will be communicated next week. All funds are SAFE now. Thank you for your cooperation and see you soon!

---

## Discussion

[Lydian DAO exploit discussion](https://github.com/vicnicius/stacks-exploited/discussions/1)
